<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Hardcode Today - Programming</title><link href="https://www.hardcode.today/" rel="alternate"></link><link href="https://www.hardcode.today/feeds/programming.atom.xml" rel="self"></link><id>https://www.hardcode.today/</id><updated>2019-09-20T00:00:00+08:00</updated><subtitle>I think, then write downâœ¨</subtitle><entry><title>macOS App è‡ªåŠ¨å‡çº§å®ç°</title><link href="https://www.hardcode.today/macos-app-zi-dong-sheng-ji-shi-xian.html" rel="alternate"></link><published>2019-09-20T00:00:00+08:00</published><updated>2019-09-20T00:00:00+08:00</updated><author><name>Gondnat</name></author><id>tag:www.hardcode.today,2019-09-20:/macos-app-zi-dong-sheng-ji-shi-xian.html</id><summary type="html">&lt;h1&gt;0. åº&lt;/h1&gt;
&lt;p&gt;macOS ä¸‹ AppStore å¤–åˆ†å‘çš„ App å‡çº§æœ€å¸¸ç”¨çš„æ˜¯ &lt;a href="https://sparkle-project.org"&gt;Sparkle&lt;/a&gt;ã€‚
å“ªè¿˜æœ‰è¿™è¾¹æ–‡ç« ä¸»è¦æ˜¯å› ä¸ºï¼Œå…¬å¸ Windows App å·²ç»æœ‰ä¸€å¥—å‡çº§æœåŠ¡å™¨æ¥å£ï¼Œä¸æƒ³å†ä¸º Mac App å•ç‹¬è®¾ç½®ä¸€å¥—æ¥å£ï¼Œæ‰€ä»¥ Mac Appè¿™è¾¹åªèƒ½è‡ªå·±å®ç°è‡ªåŠ¨å‡çº§äº†ğŸ¤·ğŸ»â€ã€‚ç„¶åå°±æœ‰äº†è¿™è¾¹ç®—æ˜¯ç¬”è®°å§ã€‚&lt;/p&gt;
&lt;h1&gt;1.å¼€å·¥&lt;/h1&gt;
&lt;p&gt;å®ç°è‡ªåŠ¨å‡çº§ï¼Œå¯ä»¥åˆ†ä¸º3éƒ¨åˆ†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹è½½æ›´æ–°åŒ…&lt;/li&gt;
&lt;li&gt;ç”¨æ–°ç‰ˆè¦†ç›–æ—§ç‰ˆApp&lt;/li&gt;
&lt;li&gt;è¿è¡Œæ–°ç‰ˆApp&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;1.1ä¸‹è½½æ›´æ–°åŒ…&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªï¼Œç›´æ¥è°ƒ URLSession ä¸‹è½½å°±å¯ä»¥ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥åƒæˆ‘ä¸€æ ·éªšæ°”çš„ç”¨ XPC å®ç°ä¹Ÿå¯ä»¥ã€‚å…³äº XPC å¯ä»¥ç‚¹å‡»&lt;a href="https://developer.apple.com/videos/play/wwdc2011/206/"&gt;è¿™é‡Œ&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1.2 ç”¨æ–°ç‰ˆè¦†ç›–æ—§ç‰ˆApp&lt;/h2&gt;
&lt;p&gt;è¿™éƒ¨åˆ†ï¼Œå…¶å®éœ€è¦åˆ†æˆä¸¤éƒ¨ï¼Œ&lt;/p&gt;
&lt;h3&gt;1.2.1 â€¦&lt;/h3&gt;</summary><content type="html">&lt;h1&gt;0. åº&lt;/h1&gt;
&lt;p&gt;macOS ä¸‹ AppStore å¤–åˆ†å‘çš„ App å‡çº§æœ€å¸¸ç”¨çš„æ˜¯ &lt;a href="https://sparkle-project.org"&gt;Sparkle&lt;/a&gt;ã€‚
å“ªè¿˜æœ‰è¿™è¾¹æ–‡ç« ä¸»è¦æ˜¯å› ä¸ºï¼Œå…¬å¸ Windows App å·²ç»æœ‰ä¸€å¥—å‡çº§æœåŠ¡å™¨æ¥å£ï¼Œä¸æƒ³å†ä¸º Mac App å•ç‹¬è®¾ç½®ä¸€å¥—æ¥å£ï¼Œæ‰€ä»¥ Mac Appè¿™è¾¹åªèƒ½è‡ªå·±å®ç°è‡ªåŠ¨å‡çº§äº†ğŸ¤·ğŸ»â€ã€‚ç„¶åå°±æœ‰äº†è¿™è¾¹ç®—æ˜¯ç¬”è®°å§ã€‚&lt;/p&gt;
&lt;h1&gt;1.å¼€å·¥&lt;/h1&gt;
&lt;p&gt;å®ç°è‡ªåŠ¨å‡çº§ï¼Œå¯ä»¥åˆ†ä¸º3éƒ¨åˆ†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹è½½æ›´æ–°åŒ…&lt;/li&gt;
&lt;li&gt;ç”¨æ–°ç‰ˆè¦†ç›–æ—§ç‰ˆApp&lt;/li&gt;
&lt;li&gt;è¿è¡Œæ–°ç‰ˆApp&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;1.1ä¸‹è½½æ›´æ–°åŒ…&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªï¼Œç›´æ¥è°ƒ URLSession ä¸‹è½½å°±å¯ä»¥ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥åƒæˆ‘ä¸€æ ·éªšæ°”çš„ç”¨ XPC å®ç°ä¹Ÿå¯ä»¥ã€‚å…³äº XPC å¯ä»¥ç‚¹å‡»&lt;a href="https://developer.apple.com/videos/play/wwdc2011/206/"&gt;è¿™é‡Œ&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1.2 ç”¨æ–°ç‰ˆè¦†ç›–æ—§ç‰ˆApp&lt;/h2&gt;
&lt;p&gt;è¿™éƒ¨åˆ†ï¼Œå…¶å®éœ€è¦åˆ†æˆä¸¤éƒ¨ï¼Œ&lt;/p&gt;
&lt;h3&gt;1.2.1 é€€å‡ºå½“å‰è¿è¡Œçš„æ—§ç‰ˆ App&lt;/h3&gt;
&lt;p&gt;é€€å‡ºæ—§ç‰ˆ Appï¼Œç›´æ¥è°ƒç”¨ NSApp.terminal(nil) å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;h3&gt;1.2.2 ç”¨æ–°ç‰ˆè¦†ç›–æ—§ç‰ˆæœ¬&lt;/h3&gt;
&lt;p&gt;è¦†ç›–éƒ¨åˆ†ï¼Œå°±ä¸èƒ½å†å½“å‰è¿›ç¨‹å¤„ç†äº†ï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥è¦å¯åŠ¨ä¸€ä¸ª helper è¿›ç¨‹ï¼Œåœ¨æ—§ç‰ˆæœ¬é€€å‡ºåï¼Œç”¨æ–°ç‰ˆè¦†ç›–æ—§ç‰ˆã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œï¼Œæˆ‘æ˜¯ç”¨ä¸‰è¡Œ shell å®ç°çš„, å¦‚ä¸‹ï¼Œå…ˆ while å¾ªç¯ç­‰å¾…å½“å‰è¿›ç¨‹é€€å‡ºï¼Œç„¶ååˆ é™¤æ—§ç‰ˆæœ¬ï¼Œæ‹·è´æ–°ç‰ˆ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt; /bin/kill -0 &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;pid&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;/dev/null&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; /bin/sleep &lt;span class="m"&gt;0&lt;/span&gt;.1&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; 
rm -fr &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;oldVersion&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
cp -r &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;newVersion&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;oldVersion&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;1.3 è¿è¡Œæ–°ç‰ˆApp&lt;/h2&gt;
&lt;p&gt;è¿è¡Œæ–°ç‰ˆæœ¬ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜è¦æ³¨æ„ï¼Œä»ç½‘ç»œä¸‹è½½çš„ App ä¼šè¢«ç³»ç»Ÿæ ‡è®°ä¸ºç½‘ç»œä¸‹è½½ï¼Œç›´æ¥æ‰“å¼€ä¼šæœ‰ä¸‹é¢æç¤ºæ¡†ã€‚ &lt;/p&gt;
&lt;p&gt;&lt;img alt="Warning" src="https://www.hardcode.today/images/warning.png"&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ‰“å¼€ä¹‹å‰ï¼Œä½¿ç”¨ä¸‹é¢ shell å‘½ä»¤å…ˆå»é™¤è¿™ä¸ªæ ‡è®°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/usr/bin/xattr -d -r com.apple.quarantine &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;appPath&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç„¶åå°±æ˜¯ç›´æ¥è°ƒç”¨ open å‘½ä»¤æ‰“å¼€æ–°ç‰ˆæœ¬ App äº†&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/usr/bin/open &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;appPath&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;2.å®Œæ•´å®ç°ä»£ç &lt;/h1&gt;
&lt;p&gt;æœ€åé™„ä¸Š Swift ä¸‹çš„å®Œæ•´å®ç°ä»£ç &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="kd"&gt;func&lt;/span&gt; &lt;span class="nf"&gt;updateToNewVersion&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;task&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;Process&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="cp"&gt;#available&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="cp"&gt;macOS&lt;/span&gt; &lt;span class="mf"&gt;10.13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executableURL&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fileURLWithPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;launchPath&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;mountPoint&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;NSTemporaryDirectory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="n"&gt;appending&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;arc4random&lt;/span&gt;&lt;span class="si"&gt;())&lt;/span&gt;&lt;span class="s"&gt;/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;FileManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fileExists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;atPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mountPoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="n"&gt;FileManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;createDirectory&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;atPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mountPoint&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;withIntermediateDirectories&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="bp"&gt;assert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;shellScript&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/bin/hdiutil attach %@ -nobrowse -mountpoint %@&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replacingOccurrences&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;of&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;mountPoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arguments&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shellScript&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;launch&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitUntilExit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;terminationStatus&lt;/span&gt;  &lt;span class="p"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;enumer&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;FileManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enumerator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;atPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mountPoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;fileName&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;enumer&lt;/span&gt;&lt;span class="p"&gt;?.&lt;/span&gt;&lt;span class="n"&gt;nextObject&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;fileName&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hasSuffix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;.app&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                    &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;newVersionAppPath&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mountPoint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;appending&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fileName&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;currentRuningAppPath&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;NSRunningApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bundleURL&lt;/span&gt;&lt;span class="p"&gt;?.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                        &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;pid&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ProcessInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;processInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;processIdentifier&lt;/span&gt;
                        &lt;span class="c1"&gt;// remove download from website flag, avoid popup warning window&lt;/span&gt;
                        &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;removeFlag&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/bin/xattr -d -r com.apple.quarantine &lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;currentRuningAppPath&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;

                        &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;script&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt;
                            &lt;span class="s"&gt;&amp;quot;while /bin/kill -0 &lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="s"&gt; &amp;gt;&amp;amp;/dev/null; do /bin/sleep 0.1; done; rm -fr &lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;currentRuningAppPath&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt; &amp;amp;&amp;amp; cp -r &lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;newVersionAppPath&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;currentRuningAppPath&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt; &amp;amp;&amp;amp; &lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;removeFlag&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="s"&gt;; /usr/bin/open &lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;currentRuningAppPath&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;; /usr/bin/hdiutil detach &lt;/span&gt;&lt;span class="si"&gt;\(&lt;/span&gt;&lt;span class="n"&gt;mountPoint&lt;/span&gt;&lt;span class="si"&gt;)&lt;/span&gt;&lt;span class="s"&gt; &amp;amp;&amp;quot;&lt;/span&gt;
                        &lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nv"&gt;task&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;Process&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
                        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="cp"&gt;#available&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="cp"&gt;macOS&lt;/span&gt; &lt;span class="mf"&gt;10.13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                            &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executableURL&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fileURLWithPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                            &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;launchPath&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;
                        &lt;span class="p"&gt;}&lt;/span&gt;
                        &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arguments&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
                        &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;launch&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
                        &lt;span class="n"&gt;NSApp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;terminate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                    &lt;span class="p"&gt;}&lt;/span&gt;
                &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="nb"&gt;Process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;launchedProcess&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;launchPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/bin/hdiutil&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arguments&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;detach&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mountPoint&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content></entry><entry><title>Go Module ä½¿ç”¨</title><link href="https://www.hardcode.today/go-module-shi-yong.html" rel="alternate"></link><published>2019-06-11T00:00:00+08:00</published><updated>2019-06-11T00:00:00+08:00</updated><author><name>Gondnat</name></author><id>tag:www.hardcode.today,2019-06-11:/go-module-shi-yong.html</id><summary type="html">&lt;h2&gt;0.å¼€å§‹&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä¸»å†…å®¹ç”¨ç¿»è¯‘è‡ª&lt;a href="https://blog.golang.org/using-go-modules"&gt;å®˜æ–¹åšå®¢&lt;/a&gt;ï¼ŒåŠ ä¸Šåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜&lt;/p&gt;
&lt;h2&gt;1.ä»‹ç»&lt;/h2&gt;
&lt;p&gt;Go åœ¨1.11 å’Œ 1.12 åŠ å…¥äº†ä¾èµ–ç®¡ç† moduleã€‚ä¸€ä¸ª module æ˜¯ä¸€ä¸ªæ ¹ç›®å½•æœ‰ä¸ª &lt;strong&gt;go.mod&lt;/strong&gt; æ–‡ä»¶çš„åŒ…ï¼ˆpackageï¼‰ã€‚ module ä¸ä¾èµ– $GOPATHï¼Œä¸éœ€è¦å°†åŒ…æ”¾åˆ° &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ GO 1.11 é‡Œï¼Œ å¦‚æœåœ¨å·¥ä½œç›®å½•æˆ–è€…å…¶ä¸Šçº§ç›®å½•å­˜åœ¨ &lt;strong&gt;go.mod&lt;/strong&gt; æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸åœ¨ &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹ï¼Œ module ç›¸å…³å‘½ä»¤è‡ªåŠ¨æ‰“å¼€ã€‚åœ¨ &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹ï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ &lt;strong&gt;&lt;em&gt;export â€¦&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</summary><content type="html">&lt;h2&gt;0.å¼€å§‹&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä¸»å†…å®¹ç”¨ç¿»è¯‘è‡ª&lt;a href="https://blog.golang.org/using-go-modules"&gt;å®˜æ–¹åšå®¢&lt;/a&gt;ï¼ŒåŠ ä¸Šåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜&lt;/p&gt;
&lt;h2&gt;1.ä»‹ç»&lt;/h2&gt;
&lt;p&gt;Go åœ¨1.11 å’Œ 1.12 åŠ å…¥äº†ä¾èµ–ç®¡ç† moduleã€‚ä¸€ä¸ª module æ˜¯ä¸€ä¸ªæ ¹ç›®å½•æœ‰ä¸ª &lt;strong&gt;go.mod&lt;/strong&gt; æ–‡ä»¶çš„åŒ…ï¼ˆpackageï¼‰ã€‚ module ä¸ä¾èµ– $GOPATHï¼Œä¸éœ€è¦å°†åŒ…æ”¾åˆ° &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ GO 1.11 é‡Œï¼Œ å¦‚æœåœ¨å·¥ä½œç›®å½•æˆ–è€…å…¶ä¸Šçº§ç›®å½•å­˜åœ¨ &lt;strong&gt;go.mod&lt;/strong&gt; æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸åœ¨ &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹ï¼Œ module ç›¸å…³å‘½ä»¤è‡ªåŠ¨æ‰“å¼€ã€‚åœ¨ &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹ï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ &lt;strong&gt;&lt;em&gt;export GO111MODULE=on&lt;/em&gt;&lt;/strong&gt;,æˆ–è€…åœ¨æ¯æ¡è¯­å¥å‰é¢åŠ ä¸Š &lt;strong&gt;GO111MODULE=on&lt;/strong&gt;ï¼Œä¸ç„¶ä¼šé‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;go&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;modules&lt;/span&gt; &lt;span class="n"&gt;disabled&lt;/span&gt; &lt;span class="n"&gt;inside&lt;/span&gt; &lt;span class="n"&gt;GOPATH&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;GO111MODULE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;see&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;go help modules&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åœ¨æœªæ¥çš„ Go 1.13 ç‰ˆæœ¬ä¸­ï¼Œ module ä¼šé»˜è®¤æ‰“å¼€ã€‚&lt;/p&gt;
&lt;h2&gt;2.å‘½ä»¤&lt;/h2&gt;
&lt;h3&gt;1.æ–°å»ºä¸€ä¸ª module&lt;/h3&gt;
&lt;p&gt;è·Ÿæ–°å»ºåŒ…ä¸€æ ·ï¼Œåªæ˜¯è¿™æ¬¡ä¸åœ¨ &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹åˆ›å»ºã€‚è¿™æ¬¡ä»¥æˆ‘å†™çš„ä¸€ä¸ª v2ray ç®¡ç† module ä¸ºä¾‹ï¼Œå¯ä»¥ä»&lt;a href="https://github.com/Gondnat/v2raymanager"&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;LICENSE&lt;/span&gt;
&lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;README&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md&lt;/span&gt;
&lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;go&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mod&lt;/span&gt;
&lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;go&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;
&lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;states&lt;/span&gt;
&lt;span class="err"&gt;â”‚&lt;/span&gt;Â Â  &lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;states&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;go&lt;/span&gt;
&lt;span class="err"&gt;â”‚&lt;/span&gt;Â Â  &lt;span class="err"&gt;â””â”€â”€&lt;/span&gt; &lt;span class="n"&gt;states_test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;go&lt;/span&gt;
&lt;span class="err"&gt;â””â”€â”€&lt;/span&gt; &lt;span class="n"&gt;usermanager&lt;/span&gt;
    &lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;go&lt;/span&gt;
    &lt;span class="err"&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;go&lt;/span&gt;
    &lt;span class="err"&gt;â””â”€â”€&lt;/span&gt; &lt;span class="n"&gt;usermanager_test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;go&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;2.ç”Ÿæˆ &lt;strong&gt;go.mod&lt;/strong&gt; æ–‡ä»¶ï¼Œæ·»åŠ ä¾èµ–&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆåœ¨æ ¹ç›®å½•è¿è¡Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ go mod init github.com/Gondnat/v2raymanager
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”Ÿæˆ &lt;strong&gt;go.mod&lt;/strong&gt; æ–‡ä»¶ï¼Œæ­¤æ—¶æ–‡ä»¶é‡Œåªæœ‰ module åå’Œ Go ç‰ˆæœ¬å·&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;module&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;github&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Gondnat&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;v2raymanager&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;go&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.12&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åˆ†åˆ«è¿›å…¥ states å’Œ usermanager ç›®å½•ï¼Œè¿è¡Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ go &lt;span class="nb"&gt;test&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ­¤æ—¶åº”è¯¥è·å¾—ç±»ä¼¼ä¸‹é¢çš„è¾“å‡º,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ go &lt;span class="nb"&gt;test&lt;/span&gt;
go: finding github.com/golang/protobuf/proto latest
go: finding v2ray.com/core/testing/scenarios latest
...
PASS
ok      github.com/Gondnat/v2raymanager/states  &lt;span class="m"&gt;3&lt;/span&gt;.666s
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ­¤æ—¶ &lt;strong&gt;go.mod&lt;/strong&gt; å†…å®¹åº”è¯¥å·²ç»å˜æˆå¦‚ä¸‹ï¼Œå¹¶ä¸”ç”Ÿæˆäº† &lt;strong&gt;go.sum&lt;/strong&gt; æ–‡ä»¶, ç”¨æ¥å­˜æ”¾æ ¡éªŒå€¼ï¼ˆå¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œå¦‚æœæ˜¯åœ¨ &lt;em&gt;$GOPATH/src&lt;/em&gt; ç›®å½•ä¸‹ï¼Œè¦è®¾ç½®ç¯å¢ƒå˜é‡ &lt;strong&gt;&lt;em&gt;GO111MODULE=on&lt;/em&gt;&lt;/strong&gt;ï¼Œè¿™é‡Œ go test å¹¶ä¸ä¼šæç¤ºé”™è¯¯ã€‚ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat go.mod
module github.com/Gondnat/v2raymanager

go &lt;span class="m"&gt;1&lt;/span&gt;.12

require &lt;span class="o"&gt;(&lt;/span&gt;
    github.com/golang/protobuf v1.3.1
    google.golang.org/grpc v1.21.1
    v2ray.com/core v4.15.0+incompatible
&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat go.sum 
cloud.google.com/go v0.26.0/go.mod h1:aQUYkXzVsufM+DwF1aE+0xfcU+56JwCaLick0ClmMTw&lt;span class="o"&gt;=&lt;/span&gt;
github.com/BurntSushi/toml v0.3.1/go.mod h1:xHWCNGjB5oqiDr8zfno3MHue2Ht5sIBksp03qcyfWMU&lt;span class="o"&gt;=&lt;/span&gt;
github.com/client9/misspell v0.3.4/go.mod h1:qj6jICC3Q7zFZvVWo7KLAzC3yx5G7kyvSDkc90ppPyw&lt;span class="o"&gt;=&lt;/span&gt;
...
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;3.å…¶ä»–æ“ä½œ&lt;/h3&gt;
&lt;h4&gt;æ˜¾ç¤ºæ‰€æœ‰ä¾èµ–&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ go list -m all
github.com/Gondnat/v2raymanager
cloud.google.com/go v0.26.0
github.com/BurntSushi/toml v0.3.1
...
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;å‡çº§ä¾èµ–&lt;/h4&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬æƒ³å‡çº§ä¸Šé¢åˆ—å‡ºæ¥çš„ä¾èµ– &lt;em&gt;github.com/BurntSushi/toml&lt;/em&gt;ï¼Œ è¿è¡Œ go getï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ go get github.com/BurntSushi/toml
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;åˆ é™¤æ— ç”¨ä¾èµ–&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ go mod tidy
&lt;/pre&gt;&lt;/div&gt;</content></entry><entry><title>å•ä¾‹çš„å®ç°</title><link href="https://www.hardcode.today/dan-li-de-shi-xian.html" rel="alternate"></link><published>2016-08-25T00:00:00+08:00</published><updated>2016-08-25T00:00:00+08:00</updated><author><name>Gondnat</name></author><id>tag:www.hardcode.today,2016-08-25:/dan-li-de-shi-xian.html</id><summary type="html">&lt;h2&gt;0. å‰è¨€&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨é¢è¯•iOSï¼Œè¢«é—®åˆ°å•ä¾‹ï¼Œæˆ‘å½“æ—¶å°±è’™ï¼ˆè¿™ä¸ªåå­—ä¼¼æ›¾ç›¸è¯†ï¼Œä½†æ˜¯çœŸçš„å…¶æƒ³ä¸èµ·å•¦ï¼ŒèƒŒæ™¯æœ¬äººObjtive-Cå®Œå…¨æ˜¯ç…§ç€å°†Categoryç¿»è¯‘æˆç±»åˆ«çš„ä¹¦æœ¬å’ŒAppleçš„å®˜æ–¹æ–‡æ¡£å­¦çš„ï¼‰ã€‚åæ¥æ™šä¸Šå›å®¶ä¸Šç½‘æœäº†æœï¼Œè¿™ä¸å°±æ˜¯å•ä¸€å®ä¾‹å¯¹è±¡ä¹ˆã€‚è®²çœŸï¼Œæˆ‘ç”¨è¿™ä¸ªåŠŸèƒ½å®Œå…¨æ˜¯æˆ‘æ‡’å¾—ä¸€ééçš„å†™allocï¼‹initã€‚&lt;/p&gt;
&lt;h2&gt;1.Objective-Cä¸‹çš„å®ç°&lt;/h2&gt;
&lt;p&gt;å› ä¸ºè¿™ä¸ªé—®é¢˜æ˜¯åœ¨é¢è¯•iOSè¢«é—®åˆ°ï¼Œæ‰€ä»¥å…ˆå†™Objective-Cä¸‹çš„ï¼Œä¹Ÿæ˜¯æœ€è›‹ç–¼çš„ä¸€ä¸ªã€‚çœ‹çœ‹C++æœ‰å¤šå¥½å†™å°±çŸ¥é“äº†ã€‚
æœ€ç®€å•çš„å†™æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;id&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;@implementation&lt;/span&gt; &lt;span class="nc"&gt;ClassA&lt;/span&gt;

&lt;span class="p"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;instancetype&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="nf"&gt;shareA&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt; &lt;span class="n"&gt;alloc&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;@end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è§£é‡Šï¼š id Aæ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œç¨‹åºè¿è¡Œæ—¶å€™ï¼Œå…¨å±€å˜é‡è¢«åˆ›å»ºï¼Œæ³¨æ„è¿™é‡ŒAæ˜¯ä¸ªæŒ‡é’ˆï¼Œæˆ‘è¯´çš„åˆ›å»ºæ˜¯æŒ‡é’ˆå˜é‡è¢«åˆ›å»ºï¼Œå°±æ˜¯å­˜å‚¨æŒ‡é’ˆçš„å˜é‡è¢«åˆ›å»ºï¼Œä¸æ˜¯AæŒ‡å‘çš„ClassAå¯¹è±¡è¢«åˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæŒ‡é’ˆæ˜¯æœ€ç®€å•çš„å®ç°ï¼Œåªæ˜¯å›¾è‡ªå·±æ–¹ä¾¿ï¼Œä¸è€ƒè™‘è¢«éæ³•ä½¿ç”¨ï¼Œæ¯”æ–¹è¯´externä¸€ä¸‹A â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;0. å‰è¨€&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨é¢è¯•iOSï¼Œè¢«é—®åˆ°å•ä¾‹ï¼Œæˆ‘å½“æ—¶å°±è’™ï¼ˆè¿™ä¸ªåå­—ä¼¼æ›¾ç›¸è¯†ï¼Œä½†æ˜¯çœŸçš„å…¶æƒ³ä¸èµ·å•¦ï¼ŒèƒŒæ™¯æœ¬äººObjtive-Cå®Œå…¨æ˜¯ç…§ç€å°†Categoryç¿»è¯‘æˆç±»åˆ«çš„ä¹¦æœ¬å’ŒAppleçš„å®˜æ–¹æ–‡æ¡£å­¦çš„ï¼‰ã€‚åæ¥æ™šä¸Šå›å®¶ä¸Šç½‘æœäº†æœï¼Œè¿™ä¸å°±æ˜¯å•ä¸€å®ä¾‹å¯¹è±¡ä¹ˆã€‚è®²çœŸï¼Œæˆ‘ç”¨è¿™ä¸ªåŠŸèƒ½å®Œå…¨æ˜¯æˆ‘æ‡’å¾—ä¸€ééçš„å†™allocï¼‹initã€‚&lt;/p&gt;
&lt;h2&gt;1.Objective-Cä¸‹çš„å®ç°&lt;/h2&gt;
&lt;p&gt;å› ä¸ºè¿™ä¸ªé—®é¢˜æ˜¯åœ¨é¢è¯•iOSè¢«é—®åˆ°ï¼Œæ‰€ä»¥å…ˆå†™Objective-Cä¸‹çš„ï¼Œä¹Ÿæ˜¯æœ€è›‹ç–¼çš„ä¸€ä¸ªã€‚çœ‹çœ‹C++æœ‰å¤šå¥½å†™å°±çŸ¥é“äº†ã€‚
æœ€ç®€å•çš„å†™æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;id&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;@implementation&lt;/span&gt; &lt;span class="nc"&gt;ClassA&lt;/span&gt;

&lt;span class="p"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;instancetype&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="nf"&gt;shareA&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt; &lt;span class="n"&gt;alloc&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;@end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è§£é‡Šï¼š id Aæ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œç¨‹åºè¿è¡Œæ—¶å€™ï¼Œå…¨å±€å˜é‡è¢«åˆ›å»ºï¼Œæ³¨æ„è¿™é‡ŒAæ˜¯ä¸ªæŒ‡é’ˆï¼Œæˆ‘è¯´çš„åˆ›å»ºæ˜¯æŒ‡é’ˆå˜é‡è¢«åˆ›å»ºï¼Œå°±æ˜¯å­˜å‚¨æŒ‡é’ˆçš„å˜é‡è¢«åˆ›å»ºï¼Œä¸æ˜¯AæŒ‡å‘çš„ClassAå¯¹è±¡è¢«åˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæŒ‡é’ˆæ˜¯æœ€ç®€å•çš„å®ç°ï¼Œåªæ˜¯å›¾è‡ªå·±æ–¹ä¾¿ï¼Œä¸è€ƒè™‘è¢«éæ³•ä½¿ç”¨ï¼Œæ¯”æ–¹è¯´externä¸€ä¸‹Aï¼Œè¿˜æœ‰å°±æ˜¯å¤šçº¿ç¨‹å¯èƒ½å­˜åœ¨ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨shareAï¼Œç»“æœç”Ÿæˆä¸¤ä»½Aã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç¬¬ä¸€ä¸ªexternçš„é—®é¢˜ï¼Œæ·»åŠ staticå°±å¯ä»¥é™åˆ¶è¢«åœ¨å…¶ä»–æºç æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯è¯·æ³¨æ„æˆ‘è¿™ä¸ªAæ˜¯åœ¨.mæ–‡ä»¶ä¸­åˆ›å»ºçš„ï¼Œæ‰€ä»¥ä½ è¦æ˜¯è·‘åˆ°.hå£°æ˜çš„è¯ï¼ŒåŠ äº†staticï¼Œé‚£å¯å°±æ˜¯Nä»½Aäº†ã€‚å¦‚æœä½ å®åœ¨ä¸å¤ªæ˜ç™½ï¼Œè¯·è¡¥ä¹ ä¸€ä¸‹Cçš„çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;p&gt;å¤šçº¿ç¨‹çš„é—®é¢˜ï¼ŒåŠ é”å°±å¯ä»¥ã€‚So easyã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è€ƒè™‘åˆ°externå’Œå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œä»£ç å°±æ”¹æˆè¿™æ ·ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;id&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;@implementation&lt;/span&gt; &lt;span class="nc"&gt;ClassA&lt;/span&gt;

&lt;span class="p"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;instancetype&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="nf"&gt;shareA&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;@synchronized&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt; &lt;span class="n"&gt;alloc&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;@end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å½“ç„¶ç½‘ä¸Šæœ‰å¥½å¤šæŠŠcopyWithZoneï¼ŒallocWithZoneä¹Ÿé‡å†™ï¼Œæ¯”æ–¹è¯´è¿™ä¸ª&lt;a href="http://www.cocoachina.com/cms/wap.php?action=article&amp;amp;id=16661"&gt;http://www.cocoachina.com/cms/wap.php?action=article&amp;amp;id=16661&lt;/a&gt;ï¼Œ å¯¹äºäº’æ–¥é”å¯ä»¥å‚è€ƒAppleçš„å®˜æ–¹æ–‡æ¡£&lt;a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html"&gt;https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;2.C++, Swift&lt;/h2&gt;
&lt;p&gt;æ˜¨å¤©é¢è¯•ä¸€ä¸‹C++ï¼Œå¥½ä¹…æ²¡æ­£ç»å†™è¿‡C++äº†ï¼Œæœ‰ç‚¹æ‰‹ç”Ÿï¼Œé¢è¯•å®˜ä¹Ÿè®©å†™ä¸ªC++çš„å•ä¾‹ï¼Œå½“æ—¶è¿˜æƒ³ç€Objective-Cçš„å•ä¾‹ï¼Œå°±å†™äº†ä¸‹é¢è¿™ä¸ª&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;static&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nv"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;NULL&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt; {
&lt;span class="nv"&gt;public&lt;/span&gt;:
    &lt;span class="nv"&gt;static&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nv"&gt;sharedA&lt;/span&gt;&lt;span class="ss"&gt;()&lt;/span&gt; {
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;NULL&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nv"&gt;A&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt; {
            &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nv"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt;&lt;span class="ss"&gt;()&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;
        }
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;A&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;
    }
}&lt;span class="c1"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ä¸ªæ ·å†™å€’ä¹Ÿæ²¡å•¥ï¼Œå°±æ˜¯ä½ è¿˜å¾—æ·»åŠ çº¿ç¨‹é”ï¼Œå¤ªéº»çƒ¦ã€‚åæ¥å›åˆ°å®¶é‡Œï¼Œç¿»äº†ä¸‹ã€ŠC++ Primerã€‹ï¼Œçœ‹çœ‹æ‹·è´æ„é€ å‡½æ•°ï¼ˆå¤åˆ¶æ„é€ å‡½æ•°ï¼‰ï¼Œå’Œèµ‹å€¼å‡½æ•°ï¼ˆå¥½å§ï¼Œæˆ‘æ‰¿è®¤æˆ‘æ¯”è¾ƒæ°´ï¼Œè¢«é—®åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼Œæˆ‘å°±æ²¡ç­”å¾—å¾ˆå¥½ï¼Œå°±å‡­å°è±¡è¯´äº†ä¸€é€š)ã€‚æƒ³æ¥ï¼ŒObjective-Cåªæœ‰å¯¹è±¡æŒ‡é’ˆï¼ŒC++å¯ä¸æ˜¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt; {
&lt;span class="nv"&gt;public&lt;/span&gt;:
    &lt;span class="nv"&gt;static&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nv"&gt;sharedA&lt;/span&gt;&lt;span class="ss"&gt;()&lt;/span&gt; {
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;A&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;
    }&lt;span class="c1"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;private&lt;/span&gt;:
    &lt;span class="nv"&gt;static&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt; &lt;span class="nv"&gt;A&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;
}&lt;span class="c1"&gt;;&lt;/span&gt;

&lt;span class="nv"&gt;ClassA&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt;::&lt;span class="nv"&gt;A&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;ClassA&lt;/span&gt;&lt;span class="ss"&gt;()&lt;/span&gt;&lt;span class="c1"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Swiftå°±æ›´ç®€å•äº†ï¼Œä½ è¦ç”¨çš„æ—¶å€™å®ƒå·²ç»å®‰å®‰é™é™çš„åœ¨é‚£é‡Œç­‰ä½ äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="n"&gt;ClassA&lt;/span&gt; {
    &lt;span class="n"&gt;static&lt;/span&gt; &lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="n"&gt;sharedA&lt;/span&gt; = &lt;span class="n"&gt;ClassA&lt;/span&gt;()
}
&lt;/pre&gt;&lt;/div&gt;</content></entry><entry><title>Build C Language Library for Android</title><link href="https://www.hardcode.today/build-c-language-library-for-android.html" rel="alternate"></link><published>2016-07-03T00:00:00+08:00</published><updated>2016-07-03T00:00:00+08:00</updated><author><name>Gondnat</name></author><id>tag:www.hardcode.today,2016-07-03:/build-c-language-library-for-android.html</id><summary type="html">&lt;h3&gt;0.Introduction&lt;/h3&gt;
&lt;p&gt;Android apps are written in Java, Java have provide &lt;a href="http://en.wikipedia.org/wiki/Java_Native_Interface"&gt;JNI(Java Native Interface)&lt;/a&gt; to call or be called by native applications and libraries written in other language such as C/C++ and assembly. Android provide NDK(Native Development Kit) to support native development in C/C++.&lt;/p&gt;
&lt;h3&gt;1.Installing â€¦&lt;/h3&gt;</summary><content type="html">&lt;h3&gt;0.Introduction&lt;/h3&gt;
&lt;p&gt;Android apps are written in Java, Java have provide &lt;a href="http://en.wikipedia.org/wiki/Java_Native_Interface"&gt;JNI(Java Native Interface)&lt;/a&gt; to call or be called by native applications and libraries written in other language such as C/C++ and assembly. Android provide NDK(Native Development Kit) to support native development in C/C++.&lt;/p&gt;
&lt;h3&gt;1.Installing NDK&lt;/h3&gt;
&lt;p&gt;The NDK can be download from &lt;a href="http://developer.android.com/tools/sdk/ndk/index.html"&gt;Android Developer Website&lt;/a&gt;. After downloaded, we get an archive package, unpack it to whereever you want, and replace the full path with &lt;em&gt;&lt;code&gt;&amp;lt;NDK-Path&amp;gt;&lt;/code&gt;&lt;/em&gt; in below.&lt;/p&gt;
&lt;h3&gt;2.Use Mobile Print Project as an example&lt;/h3&gt;
&lt;p&gt;Step 0: Read &lt;em&gt;&lt;NDK-Path&gt;/docs/OVERVIEW.html&lt;/em&gt; is helpful to understand the below steps.&lt;/p&gt;
&lt;p&gt;Step 1: Create a project directory named "exampleProject", and a subdir named "jni", copy the C/C++ code to "jni"&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;exampleProject can be change whatever you want&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Step 2: Create a file named "Android.mk", contains is likely as follow:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;LOCAL_PATH&lt;/span&gt; :&lt;span class="o"&gt;=&lt;/span&gt; $&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="k"&gt;call&lt;/span&gt; &lt;span class="nl"&gt;my&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;dir&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;include&lt;/span&gt; $&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;CLEAR_VARS&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;LOCAL_MODULE&lt;/span&gt; :&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;PMX_MobilePrinter&lt;/span&gt;
&lt;span class="nv"&gt;LOCAL_SRC_FILES&lt;/span&gt; :&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;test&lt;/span&gt;.&lt;span class="nv"&gt;c&lt;/span&gt; \
&lt;span class="nv"&gt;test1&lt;/span&gt;.&lt;span class="nv"&gt;c&lt;/span&gt;
&lt;span class="nv"&gt;LOCAL_C_INCLUDES&lt;/span&gt; :&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;test&lt;/span&gt;.&lt;span class="nv"&gt;h&lt;/span&gt;
&lt;span class="k"&gt;include&lt;/span&gt; $&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;BUILD_STATIC_LIBRARY&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The last line means, the output will be a static library, BUILD_SHARED_LIBRARY is for shared library.&lt;/p&gt;
&lt;h3&gt;3.Build for different platform&lt;/h3&gt;
&lt;p&gt;By default, the library is build for arm.Platforms are define in file "&lt;code&gt;Application.mk&lt;/code&gt;" under &lt;em&gt;jni&lt;/em&gt; directory, contains as follow:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;APP_ABI&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;all&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We need build for all platform, so the value after APP_ABI is &lt;code&gt;all&lt;/code&gt;, which can be changed to &lt;code&gt;armabi/armabi-v7a/x86/mips&lt;/code&gt;. Need to support different platform one time, just write as below, split with blank space.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;APP_ABI&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;armabi&lt;/span&gt; &lt;span class="n"&gt;armabi&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;v7a&lt;/span&gt; &lt;span class="n"&gt;x86&lt;/span&gt; &lt;span class="n"&gt;mips&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;4.Build the library&lt;/h3&gt;
&lt;p&gt;Go to the "jni", run build command &lt;em&gt;&lt;NDK-path&gt;/ndk-build&lt;/em&gt; in Terminal(Mac/Linux)/CMD(Windows). Then you will find our library in &lt;em&gt;&lt;code&gt;exampleProject/obj/local/&amp;lt;PlatformName&amp;gt;/libPMX_MobilePrinter.a&lt;/code&gt;&lt;/em&gt;. Build shared library is placed in &lt;em&gt;&lt;code&gt;exampleProject/libs/&amp;lt;PlatformName&amp;gt;/libPMX_MobilePrinter.so&lt;/code&gt;&lt;/em&gt;.&lt;/p&gt;</content></entry><entry><title>Markdown in Emacs</title><link href="https://www.hardcode.today/markdown-in-emacs.html" rel="alternate"></link><published>2014-08-20T00:00:00+08:00</published><updated>2014-08-20T00:00:00+08:00</updated><author><name>Gondnat</name></author><id>tag:www.hardcode.today,2014-08-20:/markdown-in-emacs.html</id><summary type="html">&lt;p&gt;ç®€å•çš„ä¸€ä¸ªç¬”è®°,æˆ‘åœ¨OS Xä¸‹çš„Emacsçš„Markdowné…ç½®&lt;/p&gt;
&lt;p&gt;1.ä¸‹è½½&lt;a href="http://jblevins.org/projects/markdown-mode/"&gt;Markdown-Model&lt;/a&gt;ï¼ŒæŒ‰ç…§ç½‘é¡µä¸­çš„ä»‹ç»ä¸‹è½½ã€æ·»åŠ å¯åŠ¨åˆ°.emacsæ–‡ä»¶ä¸­ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯æ€»æ˜¯æç¤ºæ‰¾ä¸åˆ°markdown-modeæ–‡ä»¶ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œgit clone åˆ°\~/.emacs.dä¸‹ï¼Œä¼šåœ¨.emcas.dç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªmarkdown-modeç›®å½•ï¼Œæ·»åŠ \~/.emacs.d/markdown-modeåˆ°load-pathã€‚æœ€ç»ˆè°ƒç”¨markdown-modeçš„é…ç½®éƒ¨åˆ†å¦‚ä¸‹&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;;;Markdown-Mode&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;to&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;list&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;load-path &amp;quot;~/.emacs.d/markdown-mode/&amp;quot;)&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;autoload&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;markdown-mode &amp;quot;markdown-mode&amp;quot; &amp;quot;Major mode for editing Markdown files&amp;quot; t)&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;to&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;list&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;auto-mode-alist &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;.markdown&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;. &lt;span class="nv"&gt;markdown&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;mode&lt;/span&gt;&lt;span class="ss"&gt;))&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add â€¦&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;ç®€å•çš„ä¸€ä¸ªç¬”è®°,æˆ‘åœ¨OS Xä¸‹çš„Emacsçš„Markdowné…ç½®&lt;/p&gt;
&lt;p&gt;1.ä¸‹è½½&lt;a href="http://jblevins.org/projects/markdown-mode/"&gt;Markdown-Model&lt;/a&gt;ï¼ŒæŒ‰ç…§ç½‘é¡µä¸­çš„ä»‹ç»ä¸‹è½½ã€æ·»åŠ å¯åŠ¨åˆ°.emacsæ–‡ä»¶ä¸­ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯æ€»æ˜¯æç¤ºæ‰¾ä¸åˆ°markdown-modeæ–‡ä»¶ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œgit clone åˆ°\~/.emacs.dä¸‹ï¼Œä¼šåœ¨.emcas.dç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªmarkdown-modeç›®å½•ï¼Œæ·»åŠ \~/.emacs.d/markdown-modeåˆ°load-pathã€‚æœ€ç»ˆè°ƒç”¨markdown-modeçš„é…ç½®éƒ¨åˆ†å¦‚ä¸‹&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;;;Markdown-Mode&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;to&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;list&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;load-path &amp;quot;~/.emacs.d/markdown-mode/&amp;quot;)&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;autoload&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;markdown-mode &amp;quot;markdown-mode&amp;quot; &amp;quot;Major mode for editing Markdown files&amp;quot; t)&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;to&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;list&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;auto-mode-alist &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;.markdown&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;. &lt;span class="nv"&gt;markdown&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;mode&lt;/span&gt;&lt;span class="ss"&gt;))&lt;/span&gt;
&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;to&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;list&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;auto-mode-alist &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;.md&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;. &lt;span class="nv"&gt;markdown&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;mode&lt;/span&gt;&lt;span class="ss"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;2.ç»è¿‡ä¸Šé¢çš„è®¾ç½®åœ¨Emacsä¸­æ‰“å¼€.mdæˆ–æ˜¯.markdownçš„æ–‡ä»¶ï¼Œå°±å¯ä»¥æœ‰é«˜äº®æ˜¾ç¤ºå¹¶å¯ä»¥æœ‰å¤šä¸­å¿«æ·é”®ä½¿ç”¨ï¼Œå¯å‚è€ƒmarkdown-modeçš„ä¸»é¡µï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ä¸‹è½½é¡µé¢ã€‚ç°åœ¨å¦‚æœä½ ä½¿ç”¨C-c C-c pé¢„è§ˆï¼Œæˆ–æ˜¯C-c C-c mç”Ÿæˆhtmlï¼Œä¼šæç¤ºæ²¡æœ‰markdownè¿™ä¸ªå‘½ä»¤ã€‚è¿™é‡Œä½¿ç”¨&lt;a href="http://brew.sh"&gt;Homebrew&lt;/a&gt;å®‰è£…pandocï¼Œä½¿ç”¨pandocå°†Markdownè½¬æ¢æˆhtmlã€‚åˆ›å»ºä¸€ä¸ªåä¸ºmarkdownçš„è„šæœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå°†å…¶æ‹·è´åˆ°/binæˆ–/usr/binç›®å½•ä¸‹ï¼Œå¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™ã€‚è‡³æ­¤å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨é¢„è§ˆåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pandoc&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="n"&gt;markdown&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="n"&gt;html&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="c1"&gt;--mathjax --highlight-style pygments $1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å‚è€ƒï¼š&lt;a href="http://panqiincs.github.io/blog/2013/05/03/emacs-markdown-mode/"&gt;http://panqiincs.github.io/blog/2013/05/03/emacs-markdown-mode/&lt;/a&gt;&lt;/p&gt;</content></entry></feed>